library(biogas)
args(summBg)
# Load functions
source('functions.R')
# Load packages
source('packages.R')
# Load functions
source('functions.R')
# Dfsumm function is used to get an overview
source('../../../functions/dfsumm.R')
# Dfsumm function is used to get an overview
source('../../../functions/dfsumm.R')
setwd("~/GitHub/GD-BMP/experiments/thermal hydrolysis/scripts")
# Load functions
source('functions.R')
# Load functions
source('functions.R')
# Load packages
source('packages.R')
# Load data
source('load.R')
# Clean data
source('clean.R')
# Set biogas options
options(unit.pres = 'kPa')
# Set BMP duration for all calls
when.BMP <- 30
# Manometric biogas calculation
cbg.man <- cumBg(biogas, dat.type = 'pres', comp = comp, temp = 35,
id.name = 'id', time.name = 'elapsed.time',
dat.name = 'pres.init', comp.name = 'xCH4',
temp.init = 20,
pres.resid = 'pres.resid', pres.init = 0, pres.amb = 101.325,
headspace = setup, vol.hs.name = 'vol.hs',
extrap = TRUE,
absolute = FALSE)
# Gravimetric biogas calculation
cbg.grav <- cumBg(biogas, dat.type = 'mass', comp = comp, temp = 30, pres = 150,
id.name = 'id', time.name = 'elapsed.time',
dat.name = 'mass.final', comp.name = 'xCH4',
headspace = setup, vol.hs.name = 'vol.hs', headcomp = 'N2',
temp.init = 20,
extrap = TRUE)
# Volumetric biogas calculation
cbg.vol <- cumBg(biogas, dat.type = 'vol', comp = comp, temp = 20, pres = 101.325,
id.name = 'id', time.name = 'elapsed.time',
dat.name = 'vol', comp.name = 'xCH4',
headspace = setup, vol.hs.name = 'vol.hs', headcomp = 'N2',
extrap = TRUE)
# GD method
biogas <- biogas[order(biogas$id, biogas$elapsed.time), ]
cbg.gd <- as.data.frame(mutate(group_by(biogas, id), cvol = cumsum(vol), cmassloss = mass.final[1]-mass.final))
# Make a GD data frame
cbg.gd$xCH4 <- gdComp(cbg.gd$cmassloss, cbg.gd$cvol, temp = 20, pres = 101.325)
# volumetric less sensitive to comp.therefore, use this one with GD. Can also try others afterwards.
## But when using dat.type = 'vol' - wont it affect the results which method is used?
cbg.gd <- cumBg(cbg.gd, dat.type = 'vol', temp = 20, pres = 101.325,
data.struct = 'longcombo',
id.name = 'id', time.name = 'elapsed.time',
dat.name = 'vol', comp.name = 'xCH4',
headspace = setup, vol.hs.name = 'vol.hs', headcomp = 'N2',
showt0 = FALSE, temp.init = 20,
addt0 = FALSE, extrap = TRUE)
cbg.list <- list(vol = cbg.vol, man = cbg.man, grav = cbg.grav, gd = cbg.gd)
BMP <- summBg(cbg.list, setup, id.name = "id",
time.name = 'elapsed.time', descrip.name = 'descrip',
inoc.name = "I", inoc.m.name = "m.inoc", norm.name = "m.sub.vs",
when = when.BMP, extrap = TRUE, set.name = 'method')
View(BMP)
# The last two methods
# o for "obs" = one value for each bottle
#BMPo <- ... show.obs = TRUE)
BMPo <- summBg(cbg.list, setup, id.name = "id",
time.name = 'elapsed.time', descrip.name = 'descrip',
inoc.name = "I", inoc.m.name = "m.inoc", norm.name = "m.sub.vs",
when = when.BMP, extrap = TRUE, set.name = 'method', show.obs = TRUE)
View(BMPo)
# yld for yield
#yld <- ... when = 'meas')
yld <- summBg(cbg.list, setup, id.name = "id",
time.name = 'elapsed.time', descrip.name = 'descrip',
inoc.name = "I", inoc.m.name = "m.inoc", norm.name = "m.sub.vs",
when = meas, extrap = TRUE, set.name = 'method')
# yld for yield
#yld <- ... when = 'meas')
yld <- summBg(cbg.list, setup, id.name = "id",
time.name = 'elapsed.time', descrip.name = 'descrip',
inoc.name = "I", inoc.m.name = "m.inoc", norm.name = "m.sub.vs",
when = 'meas', extrap = TRUE, set.name = 'method')
View(yld)
# Bind by rows
cbg.vol$method <- 'vol'
cbg.man$method <- 'man'
cbg.grav$method <- 'grav'
cbg.gd$method <- 'gd'
cbg.all <- biogas:::rbindf(cbg.vol, cbg.man, cbg.grav, cbg.gd)
View(cbg.all)
# Load functions
source('functions.R')
# Load packages
source('packages.R')
# Load data
source('load.R')
# Clean data
source('clean.R')
# Calculate biogas production
source('biogas.R')
args(spread)
install.packages("tidyr")
library(tidyr)
View(BMP)
args(spread)
BMP.c <- spread(BMP, method)
reshape(BMP, idvar = 1)
reshape(BMP, idvar = "method")
args(reshape)
reshape(BMP)
reshape(BMP, direction = "long")
reshape(BMP, direction = "long", varying = names(BMP))
reshape(BMP, direction = "wide", varying = names(BMP))
reshape(BMP, varying = names(BMP))
reshape(BMP, direction = "wide", varying = names(BMP))
names(BMP)
reshape(BMP, direction = "wide", varying = "method")
reshape(BMP, direction = "wide", varying = "method")
reshape(BMP, varying = "method", direction = "wide")
rownames(BMP)
names(BMP)
reshape(BMP, varying = c("method", descrip), direction = "wide")
reshape(BMP, varying = "method", direction = "wide")
# Camilla G. Justesen
# Load functions
source('functions.R')
# Load packages
source('packages.R')
# Load data
source('load.R')
# Clean data
source('clean.R')
# Calculate biogas production
source('biogas.R')
# Clean data prior to analysis
source('merge.R')
# Compare methods numerically
source('numeric_comparison.R')
# Check if all elapsed time columns are identical
all(BMP.all.c$elapsed.time_man == BMP.all.c$elapsed.time_grav)
all(BMP.all.c$elapsed.time_man == BMP.all.c$elapsed.time_vol)
# Graphical comparison of methods
source('plots.R')
# Some other possibilities . . .
cbg.all$pid <- interaction(cbg.all$id, cbg.all$method)
ggplot(cbg.all, aes(elapsed.time, cvCH4, group = pid)) +
geom_line(aes(colour = method)) +
facet_wrap(~ descrip)
# Plot of data before corrected for inoculum (grav)
ggplot(cbg.grav, aes(elapsed.time, cvCH4, colour = grav.subs.type, group = id )) +
geom_point() +
geom_line() +
ggtitle("Gravimetric") +
labs(x = "Elapsed Time [hr]", y = "Cumulative CH4 [mL]", colour = "Substrate")  +
theme_bw() +
theme(text = element_text(size = 10))
ggsave('../plots/gravimetric_biogas.png')
View(cbg.grav)
ggplot(BMP, aes(method, mean, colour = descrip)) +
geom_point() + geom_line(aes(group = descrip)) +
geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
position=position_dodge(0.05)) +
labs(x = 'Method', y = 'Mean Cumulative CH4 [mL]', colour = 'Description')  +
theme_bw() +
theme(text = element_text(size = 10))
# Plot with reverse of method/descrip
ggplot(BMP, aes(descrip, mean, colour = method)) +
geom_point() + geom_line(aes(group = method)) +
geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
position=position_dodge(0.05)) +
labs(x = 'Description', y = 'Mean Cumulative CH4 [mL]', colour = 'Method')  +
theme_bw() +
theme(text = element_text(size = 10))
# Plots for method comparison directly
plot(BMP.c$mean_gd, BMP.all.c$mean_grav)         # Seems to be no relation to grav
